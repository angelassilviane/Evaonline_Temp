# ğŸ—ï¸ Arquitetura de Monitoramento EVAonline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USUÃRIOS FINAIS                          â”‚
â”‚  ğŸ‘¤ Gestores  ğŸ‘¤ Stakeholders  ğŸ‘¤ Pesquisadores  ğŸ‘¤ PÃºblico    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP (Read-Only)
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   ğŸ¨ GRAFANA (3000)   â”‚
            â”‚  Dashboard Simplificadoâ”‚
            â”‚  âœ… Status Sistema     â”‚
            â”‚  â±ï¸  Tempo Resposta    â”‚
            â”‚  ğŸ“Š Consultas Hoje     â”‚
            â”‚  âš¡ Cache Performance  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ PromQL Queries
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ ğŸ“Š PROMETHEUS (9090)  â”‚
            â”‚  Time-Series Database  â”‚
            â”‚  Coleta mÃ©tricas a     â”‚
            â”‚  cada 15 segundos      â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚         â”‚              â”‚
        â”‚ /metricsâ”‚/metrics â”‚/metrics      â”‚/metrics
        â–¼         â–¼         â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API   â”‚ â”‚REDIS â”‚ â”‚POSTGRESâ”‚    â”‚ CELERY  â”‚
    â”‚ :8000 â”‚ â”‚ :6379â”‚ â”‚  :5432 â”‚    â”‚ Worker  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Requests
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USUÃRIOS API    â”‚
â”‚  ğŸ”§ Desenvolvedoresâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    FLUXO DE MÃ‰TRICAS

1ï¸âƒ£  API recebe request
    â””â”€> Incrementa contador: api_requests_total
    â””â”€> Registra latÃªncia: api_request_duration_seconds
    â””â”€> Cache hit/miss: cache_hits_total / cache_misses_total

2ï¸âƒ£  Prometheus faz scraping a cada 15s
    â””â”€> GET http://api:8000/metrics
    â””â”€> Armazena em time-series database

3ï¸âƒ£  Grafana executa queries PromQL
    â””â”€> Busca dados do Prometheus
    â””â”€> Renderiza dashboards visuais
    â””â”€> Atualiza a cada 30s

4ï¸âƒ£  Alertas sÃ£o disparados (se configurado)
    â””â”€> Slack / Email / PagerDuty
    â””â”€> Baseado em thresholds (ex: error rate > 5%)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                  DASHBOARDS DISPONÃVEIS

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š "EVAonline - VisÃ£o do UsuÃ¡rio" (PÃšBLICO)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… Status Online/Offline                                   â”‚
â”‚  â±ï¸  Tempo de Resposta MÃ©dio (P50)                         â”‚
â”‚  ğŸ“ˆ Consultas nas Ãšltimas 24h                               â”‚
â”‚  âš¡ Taxa de Cache Hit (%)                                   â”‚
â”‚  ğŸŒ DistribuiÃ§Ã£o GeogrÃ¡fica                                 â”‚
â”‚  ğŸ’¡ Economia de Tempo (cache)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”§ "EVAonline Application Metrics" (DEVOPS)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š API Requests per Second                                 â”‚
â”‚  â±ï¸  Response Time (P50, P95, P99)                         â”‚
â”‚  ğŸ’¾ Cache Performance (hits/misses)                         â”‚
â”‚  âš ï¸  Error Rate (4xx, 5xx)                                  â”‚
â”‚  ğŸ–¥ï¸  System Resources (CPU, RAM, Disk)                     â”‚
â”‚  ğŸ”„ Celery Tasks (pending/running/failed)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    MÃ‰TRICAS COLETADAS

ğŸ“Š API Metrics (FastAPI):
   â”œâ”€ http_requests_total (Counter)
   â”œâ”€ http_request_duration_seconds (Histogram)
   â”œâ”€ api_active_requests (Gauge)
   â”œâ”€ cache_hits_total (Counter)
   â”œâ”€ cache_misses_total (Counter)
   â””â”€ popular_data_accesses (Counter)

ğŸ’¾ Redis Metrics:
   â”œâ”€ redis_connected_clients
   â”œâ”€ redis_memory_used_bytes
   â””â”€ redis_commands_processed_total

ğŸ—„ï¸  PostgreSQL Metrics:
   â”œâ”€ pg_up
   â”œâ”€ pg_connections_active
   â”œâ”€ pg_queries_duration_seconds
   â””â”€ pg_database_size_bytes

ğŸ”„ Celery Metrics:
   â”œâ”€ celery_tasks_total (by state: pending/running/success/failure)
   â”œâ”€ celery_task_duration_seconds
   â””â”€ celery_workers_active

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    NÃVEIS DE ACESSO

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ferramenta â”‚    URL       â”‚   Acesso    â”‚    UsuÃ¡rio       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Grafana    â”‚  :3000       â”‚  AnÃ´nimo    â”‚  ğŸ‘¥ Todos       â”‚
â”‚  (Viewer)   â”‚              â”‚  Read-Only  â”‚                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Grafana    â”‚  :3000/login â”‚  admin/     â”‚  ğŸ”§ DevOps      â”‚
â”‚  (Admin)    â”‚              â”‚  admin      â”‚  Admin           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Prometheus â”‚  :9090       â”‚  Aberto     â”‚  ğŸ”§ Devs        â”‚
â”‚             â”‚              â”‚             â”‚  DevOps          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Swagger    â”‚  :8000/      â”‚  Aberto     â”‚  ğŸ”§ Devs        â”‚
â”‚  Docs       â”‚  api/v1/docs â”‚             â”‚                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /metrics   â”‚  :8000/      â”‚  Aberto     â”‚  ğŸ”§ Devs        â”‚
â”‚             â”‚  metrics     â”‚             â”‚  Prometheus      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    ALERTAS CONFIGURADOS

âš ï¸  High Error Rate (Critical)
    CondiÃ§Ã£o: error_rate > 5% por 5 minutos
    AÃ§Ã£o: Notificar DevOps via Slack
    
â±ï¸  High Latency (Warning)
    CondiÃ§Ã£o: P95 > 2 segundos por 10 minutos
    AÃ§Ã£o: Email para equipe de backend
    
ğŸ’¾ Low Cache Hit Rate (Warning)
    CondiÃ§Ã£o: cache_hit_rate < 70% por 15 minutos
    AÃ§Ã£o: Notificar via Slack
    
ğŸ”´ Service Down (Critical)
    CondiÃ§Ã£o: up == 0
    AÃ§Ã£o: PagerDuty + SMS para on-call

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    RETENÃ‡ÃƒO DE DADOS

ğŸ“… Prometheus:
   â”œâ”€ Raw data: 15 dias
   â”œâ”€ AgregaÃ§Ãµes 5min: 30 dias
   â””â”€ AgregaÃ§Ãµes 1h: 90 dias

ğŸ“… Grafana:
   â”œâ”€ Dashboards: Persistente (grafana_data volume)
   â””â”€ Snapshots: Opcional (API ou plugin)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    PRÃ“XIMOS PASSOS

âœ… Implementado:
   â”œâ”€ Prometheus coletando mÃ©tricas
   â”œâ”€ Grafana com 2 dashboards
   â”œâ”€ Acesso anÃ´nimo (read-only)
   â””â”€ API expondo /metrics

ğŸ“‹ Sugerido:
   â”œâ”€ Configurar alertas (Slack/Email)
   â”œâ”€ Adicionar Redis Exporter
   â”œâ”€ Adicionar PostgreSQL Exporter
   â”œâ”€ Configurar backup de dashboards
   â”œâ”€ Implementar rate limiting por IP
   â””â”€ Adicionar autenticaÃ§Ã£o OAuth (prod)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
