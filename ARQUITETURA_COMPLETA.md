# ğŸ“ ARQUITETURA COMPLETA: Open-Meteo â†’ ETo â†’ PostgreSQL

## ğŸ”„ Fluxo de Dados Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          5 FONTES DE DADOS CLIMÃTICOS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  ğŸŒ NASA POWER (Global)        â˜€ï¸ Open-Meteo Archive (Global, 1950+)       â”‚
â”‚     DomÃ­nio PÃºblico            CC0 - Sem restriÃ§Ãµes                        â”‚
â”‚     Delay: 2-7 dias            Delay: Nenhum                              â”‚
â”‚                                                                               â”‚
â”‚  ğŸ”® Open-Meteo Forecast (Global)  ğŸ‡ªğŸ‡º MET Norway (Europa)                  â”‚
â”‚     CC0 - Sem restriÃ§Ãµes          CC-BY 4.0                                â”‚
â”‚     PrevisÃ£o: 16 dias             Real-time, Alta qualidade               â”‚
â”‚                                                                               â”‚
â”‚  ğŸ‡ºğŸ‡¸ NWS USA (USA Continental)                                               â”‚
â”‚     DomÃ­nio PÃºblico                                                         â”‚
â”‚     Real-time, 2x/dia                                                       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“â†“â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PHASE 1: DOWNLOAD (backend/api/services/)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ nasa_power_      â”‚     â”‚ openmeteo_client.py      â”‚                     â”‚
â”‚  â”‚ client.py        â”‚     â”‚ â”œâ”€ Archive (13 vars)     â”‚                     â”‚
â”‚  â”‚ (321 lines)      â”‚     â”‚ â””â”€ Forecast (13 vars)    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                            â”‚                                      â”‚
â”‚         â–¼                            â–¼                                      â”‚
â”‚  7 variÃ¡veis:                13 variÃ¡veis:                                 â”‚
â”‚  T2M_MAX, T2M_MIN           temperature_2m_max/min/mean                   â”‚
â”‚  T2M, RH2M, WS2M            precipitation_sum                              â”‚
â”‚  ALLSKY_SFC_SW_DWN          wind_speed_10m_max/mean                        â”‚
â”‚  PRECTOTCORR                shortwave_radiation_sum                        â”‚
â”‚                              relative_humidity_2m_max/mean/min             â”‚
â”‚                              daylight_duration                              â”‚
â”‚                              sunshine_duration                              â”‚
â”‚                              âœ¨ et0_fao_evapotranspiration (JÃ CALC)      â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ climate_factory.py - Factory Pattern                   â”‚                â”‚
â”‚  â”‚ â”œâ”€ create_nasa_power()                                â”‚                â”‚
â”‚  â”‚ â”œâ”€ create_openmeteo_archive()                         â”‚                â”‚
â”‚  â”‚ â”œâ”€ create_openmeteo_forecast()                        â”‚                â”‚
â”‚  â”‚ â”œâ”€ create_met_norway()                                â”‚                â”‚
â”‚  â”‚ â””â”€ create_nws()                                       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“â†“â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PHASE 2: CACHE (backend/infrastructure/cache/)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Redis Cache (climate_data_cache.py)                 â”‚                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚  â”‚                                                      â”‚                   â”‚
â”‚  â”‚ Keys:                          TTL:                 â”‚                   â”‚
â”‚  â”‚ climate:nasa_power:{lat}:{lon}:{date}  â†’ 2 dias   â”‚                   â”‚
â”‚  â”‚ climate:openmeteo_archive:{...}        â†’ 30 dias  â”‚                   â”‚
â”‚  â”‚ climate:openmeteo_forecast:{...}       â†’ 6 horas  â”‚                   â”‚
â”‚  â”‚ climate:met_norway:{...}               â†’ 24 horas â”‚                   â”‚
â”‚  â”‚ climate:nws:{...}                      â†’ 12 horas â”‚                   â”‚
â”‚  â”‚ preprocess:{lat}:{lon}:{date}          â†’ 24 horas â”‚                   â”‚
â”‚  â”‚ fusion:{lat}:{lon}:{date}              â†’ 12 horas â”‚                   â”‚
â”‚  â”‚                                                      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                               â”‚
â”‚  Hit Rate: ~80% para requisiÃ§Ãµes repetidas                                  â”‚
â”‚  Storage: ~100MB para ano inteiro (10 locais)                              â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“â†“â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    PHASE 3: PROCESSING (backend/core/data_processing/)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ data_download.py                                       â”‚                â”‚
â”‚  â”‚ â”œâ”€ Valida coordenadas e datas                         â”‚                â”‚
â”‚  â”‚ â”œâ”€ Faz download de mÃºltiplas fontes                   â”‚                â”‚
â”‚  â”‚ â”œâ”€ Verifica cache antes                               â”‚                â”‚
â”‚  â”‚ â””â”€ Normaliza colunas para padrÃ£o interno (7 vars)    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ data_preprocessing.py (updated)                        â”‚                â”‚
â”‚  â”‚ â”œâ”€ Valida com limites fÃ­sicos (Xavier et al)          â”‚                â”‚
â”‚  â”‚ â”œâ”€ Detecta outliers (IQR method)                       â”‚                â”‚
â”‚  â”‚ â”œâ”€ Imputa dados faltantes (interpolaÃ§Ã£o linear)       â”‚                â”‚
â”‚  â”‚ â””â”€ Suporta mÃºltiplas fontes/formatos                  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ data_fusion.py (Kalman Ensemble)                       â”‚                â”‚
â”‚  â”‚ â”œâ”€ Combina mÃºltiplas fontes                           â”‚                â”‚
â”‚  â”‚ â”œâ”€ Ensemble Size: 50                                  â”‚                â”‚
â”‚  â”‚ â”œâ”€ Valida licenÃ§as âœ… (NASA POWER, MET, NWS)         â”‚                â”‚
â”‚  â”‚ â””â”€ Retorna estado analisado                           â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                               â”‚
â”‚  Input:   DataFrame 7 colunas (T2M_MAX, T2M_MIN, ...)                      â”‚
â”‚  Output:  DataFrame processado, validado e fusionado                       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“â†“â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PHASE 4: CALCULATION (backend/core/eto_calculation/)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ eto_calculation.py                                     â”‚                â”‚
â”‚  â”‚ â”œâ”€ Implementa FAO-56 Penman-Monteith                  â”‚                â”‚
â”‚  â”‚ â”œâ”€ Calcula Ra (radiaÃ§Ã£o extraterrestre)               â”‚                â”‚
â”‚  â”‚ â”œâ”€ Calcula pressÃ£o de saturaÃ§Ã£o de vapor              â”‚                â”‚
â”‚  â”‚ â”œâ”€ Calcula dÃ©fice de pressÃ£o de vapor                 â”‚                â”‚
â”‚  â”‚ â”œâ”€ Calcula radiaÃ§Ã£o lÃ­quida (Rn)                      â”‚                â”‚
â”‚  â”‚ â””â”€ Retorna ETo (mm/dia)                               â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                               â”‚
â”‚  Inputs:                          Outputs:                                 â”‚
â”‚  - Dados validados (7 vars)        - ETo calculado (mm/dia)               â”‚
â”‚  - ElevaÃ§Ã£o (m)                    - Intervalo de confianÃ§a               â”‚
â”‚  - Latitude (Â°)                    - Qualidade dos dados                   â”‚
â”‚                                                                               â”‚
â”‚  ValidaÃ§Ã£o:                                                                 â”‚
â”‚  ETo_calculated â‰ˆ ET0_openmeteo (para dados Open-Meteo)                    â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“â†“â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PHASE 5: STORAGE (backend/database/)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ PostgreSQL (15-alpine)               â”‚                                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  â”‚
â”‚  â”‚                                      â”‚                                  â”‚
â”‚  â”‚  ğŸ“‹ locations (337 cidades MATOPIBA) â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ id, name, lat, lon, elevation   â”‚                                  â”‚
â”‚  â”‚  â””â”€ state, city, region             â”‚                                  â”‚
â”‚  â”‚                                      â”‚                                  â”‚
â”‚  â”‚  ğŸ“Š climate_data (histÃ³rico)         â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ location_id (FK)                 â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ date, source                     â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ 13 variÃ¡veis climÃ¡ticas         â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ et0_fao_evapotranspiration      â”‚                                  â”‚
â”‚  â”‚  â””â”€ quality_flag                     â”‚                                  â”‚
â”‚  â”‚     Ãndices: (location, date), source â”‚                                 â”‚
â”‚  â”‚     TTL: 1-2 anos de dados           â”‚                                  â”‚
â”‚  â”‚                                      â”‚                                  â”‚
â”‚  â”‚  ğŸ“ˆ eto_results (agregado)           â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ location_id (FK)                 â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ start_date, end_date             â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ eto_sum, eto_mean, eto_max      â”‚                                  â”‚
â”‚  â”‚  â”œâ”€ estatÃ­sticas (std_dev, etc)     â”‚                                  â”‚
â”‚  â”‚  â””â”€ data_quality, method             â”‚                                  â”‚
â”‚  â”‚     Ãndices: (location, date), period â”‚                                 â”‚
â”‚  â”‚     TTL: 5 anos (histÃ³rico)          â”‚                                  â”‚
â”‚  â”‚                                      â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                               â”‚
â”‚  climate_repository.py (DAL)                                                â”‚
â”‚  â”œâ”€ insert_climate_data()                                                   â”‚
â”‚  â”œâ”€ insert_eto_result()                                                     â”‚
â”‚  â”œâ”€ get_climate_data()                                                      â”‚
â”‚  â””â”€ get_eto_results()                                                       â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“â†“â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PHASE 6: VISUALIZATION (frontend/)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Dash Dashboard (app.py)                               â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚                                                        â”‚                 â”‚
â”‚  â”‚ Mapas:                                                 â”‚                 â”‚
â”‚  â”‚ â”œâ”€ Mapa interativo MATOPIBA (337 cidades)            â”‚                 â”‚
â”‚  â”‚ â”œâ”€ Heat map de densidade                              â”‚                 â”‚
â”‚  â”‚ â””â”€ Limites de estados (Brasil)                        â”‚                 â”‚
â”‚  â”‚                                                        â”‚                 â”‚
â”‚  â”‚ GrÃ¡ficos:                                              â”‚                 â”‚
â”‚  â”‚ â”œâ”€ ETo vs Temperatura (barras + linhas)              â”‚                 â”‚
â”‚  â”‚ â”œâ”€ ETo vs RadiaÃ§Ã£o (dual axis)                       â”‚                 â”‚
â”‚  â”‚ â”œâ”€ PrecipitaÃ§Ã£o acumulada                             â”‚                 â”‚
â”‚  â”‚ â””â”€ SÃ©rie temporal com desvio padrÃ£o                   â”‚                 â”‚
â”‚  â”‚                                                        â”‚                 â”‚
â”‚  â”‚ Tabelas:                                               â”‚                 â”‚
â”‚  â”‚ â”œâ”€ Dados diÃ¡rios (date, temp, humidity, ETo)        â”‚                 â”‚
â”‚  â”‚ â”œâ”€ EstatÃ­sticas descritivas                           â”‚                 â”‚
â”‚  â”‚ â”œâ”€ Teste de normalidade (Shapiro-Wilk)              â”‚                 â”‚
â”‚  â”‚ â””â”€ Matriz de correlaÃ§Ã£o                               â”‚                 â”‚
â”‚  â”‚                                                        â”‚                 â”‚
â”‚  â”‚ ExportaÃ§Ã£o:                                            â”‚                 â”‚
â”‚  â”‚ â”œâ”€ CSV                                                 â”‚                 â”‚
â”‚  â”‚ â”œâ”€ Excel                                               â”‚                 â”‚
â”‚  â”‚ â””â”€ PDF (relatÃ³rio)                                    â”‚                 â”‚
â”‚  â”‚                                                        â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Tabela Resumida de Fluxos

| Fase | Componente | Input | Output | Cache | Armazenamento |
|------|-----------|-------|--------|-------|---------------|
| 1 | NASA POWER Client | (lat, lon, date) | DataFrame 7 cols | Redis 2d | âŒ |
| 1 | Open-Meteo Client | (lat, lon, date) | DataFrame 13 cols | Redis 30d | âŒ |
| 2 | Cache Manager | DataFrame | DataFrame cached | Redis | - |
| 3 | Preprocessing | DataFrame | Validated/Imputed | Redis 24h | âŒ |
| 3 | Fusion | List[DataFrame] | Merged DataFrame | Redis 12h | âŒ |
| 4 | ETo Calculation | DataFrame | DataFrame + ETo | Redis 24h | PostgreSQL |
| 5 | Repository | DataFrame | Persisted | - | PostgreSQL âœ… |
| 6 | Dashboard | PostgreSQL | Visualization | Memory | Frontend |

---

## ğŸ”— DependÃªncias Entre Fases

```
FASE 1 (Download)
    â†“
    â””â”€â†’ FASE 2 (Cache) âœ… CONCLUÃDO
    
        â†“
        â””â”€â†’ FASE 3 (Preprocessing/Fusion) â³ COMEÃ‡ANDO
                â†“
                â””â”€â†’ FASE 4 (ETo Calculation) â³ SERÃ ADAPTADO
                        â†“
                        â””â”€â†’ FASE 5 (PostgreSQL) â³ SERÃ CRIADO
                                â†“
                                â””â”€â†’ FASE 6 (Visualization) âœ… JÃ EXISTE
```

---

## âœ… Checklist de ImplementaÃ§Ã£o

### FASE 3
- [ ] Atualizar `data_preprocessing.py` para 13 variÃ¡veis
- [ ] Resolver bloqueio de licenÃ§a em `data_fusion.py`
- [ ] Integrar Open-Meteo em `data_download.py`
- [ ] Testes end-to-end

### FASE 4
- [ ] Criar `climate_data_cache.py`
- [ ] Integrar cache em `data_download.py`
- [ ] Integrar cache em `data_fusion.py`
- [ ] Integrar cache em `eto_calculation.py`

### FASE 5
- [ ] Criar migraÃ§Ã£o Alembic (003_climate_tables.py)
- [ ] Implementar `climate_repository.py`
- [ ] Testar I/O PostgreSQL
- [ ] Integrar salvamento em pipeline

### FASE 6 (JÃ¡ existe)
- [ ] Atualizar frontend para usar PostgreSQL
- [ ] Adicionar filtros (data, fonte, qualidade)
- [ ] Adicionar exportaÃ§Ã£o

---

## ğŸ“š Arquivos Importantes

**Criados (FASE 1-2):**
- âœ… `backend/api/services/openmeteo_client.py`
- âœ… `backend/api/services/openmeteo_archive_client.py`
- âœ… `backend/api/services/climate_factory.py` (atualizado)

**A Criar/Atualizar (FASE 3-5):**
- â³ `backend/core/data_processing/data_preprocessing.py`
- â³ `backend/core/data_processing/data_fusion.py`
- â³ `backend/core/data_processing/data_download.py`
- â³ `backend/infrastructure/cache/climate_data_cache.py`
- â³ `backend/database/climate_repository.py`
- â³ `alembic/versions/003_create_climate_tables.py`

---

## ğŸ¯ PrÃ³ximo Passo

**ComeÃ§ar FASE 3:** Atualizar `data_preprocessing.py` para aceitar 13 variÃ¡veis do Open-Meteo!
